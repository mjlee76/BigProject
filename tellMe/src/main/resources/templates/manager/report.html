<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<html lang="en">
<head th:replace="layouts/navbar::tellMe_head"/>
<head th:replace="layouts/footer::tellMe_foot"/>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보고서 관리</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/report.css}" />
    <script type="text/javascript" th:src="@{/js/report.js}"></script>
</head>
<body>
<div th:replace="layouts/navbar::tellMe_header"></div>
<main class="container">
    <div class="report-header">
        <h1>보고서 관리</h1>
    </div>
    <!-- 탭 -->
    <div class="tabs">
        <!-- 기존 탭 클릭 시 status 값 전달 -->

        <a class="tab" th:href="@{/manager/report(query=${query}, status='all', page=1)}"
           th:classappend="${status == 'all'} ? 'active' : ''" data-filter="all">전체</a>
        <a class="tab" th:href="@{/manager/report(query=${query}, status='확인완료', page=1)}"
           th:classappend="${status == '확인완료'} ? 'active' : ''" data-filter="확인완료">확인 완료</a>
        <a class="tab" th:href="@{/manager/report(query=${query}, status='미확인', page=1)}"
           th:classappend="${status == '미확인'} ? 'active' : ''" data-filter="미확인">미확인</a>
    </div>



    <!-- 검색창 -->
    <div class="search-bar">
        <form id="search-form" th:action="@{/manager/report}" method="get">
            <input type="text" placeholder="검색어를 입력하세요." id="search-input" name="query">
            <input type="hidden" name="status" th:value="${status}">  <!-- 기존 상태 유지 -->
            <input type="hidden" name="page" value="1">  <!-- 검색 시 항상 첫 페이지로 이동 -->
            <button type="submit" class="search-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round" class="feather feather-search" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </button>
        </form>

    </div>

    <!-- 보고서 목록 -->
    <table class="post-table">
        <thead>
        <tr>
            <th>번호</th>
            <th>보고서</th>
            <th>작성일</th>
            <th>유형</th>
            <th>상태</th>
            <th>다운로드</th>
        </tr>
        </thead>
        <tbody>
        <!-- 데이터가 없는 경우 -->
        <tr th:if="${reports.isEmpty()}">
            <td colspan="6" style="text-align: center;">등록된 보고서가 없습니다.</td>
        </tr>
        <!-- 데이터베이스에서 불러온 보고서 목록 표시 -->
        <tr th:each="report, stat : ${reports}">
            <td th:text="${(currentPage - 1) * 10 + stat.index + 1}"></td>  <!-- 순번 계산 -->
            <td>
                <!-- 보고서 제목 클릭 시 웹뷰어에서 열기 -->
                <a th:href="@{/manager/report/view/{id}(id=${report.id})}" target="_blank">
                    <span th:text="${report.report}"></span>
                </a>
            </td>
            <td th:text="${#temporals.format(report.createDate, 'yyyy-MM-dd')}"></td>
            <td th:text="${report.category}"></td>
            <td th:text="${report.reportStatus}" th:classappend="${report.reportStatus == '미확인' ? 'unchecked' : 'checked'}"></td>
            <td>
                <a th:href="@{/manager/report/view/{id}(id=${report.id})}" class="download-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </a>
            </td>
        </tr>
        </tbody>
    </table>

    <!--        &lt;!&ndash; 보고서 리스트 예시 &ndash;&gt;-->
    <!--        <tr>-->
    <!--            <th>1</th>-->
    <!--            <td>특이 민원 보고서1</td>-->
    <!--            <td>2025-01-31</td>-->
    <!--            <td>협박</td>-->
    <!--            <td class="status unchecked">미확인</td>-->
    <!--            <td>-->
    <!--                <a href="#" class="download-link">-->
    <!--                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download" viewBox="0 0 24 24">-->
    <!--                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>-->
    <!--                        <polyline points="7 10 12 15 17 10"></polyline>-->
    <!--                        <line x1="12" y1="15" x2="12" y2="3"></line>-->
    <!--                    </svg>-->
    <!--                </a>-->
    <!--            </td>-->
    <!--        </tr>-->
    <!--        <tr>-->
    <!--            <th>2</th>-->
    <!--            <td>특이 민원 보고서2</td>-->
    <!--            <td>2025-01-30</td>-->
    <!--            <td>폭행</td>-->
    <!--            <td class="status checked">확인 완료</td>-->
    <!--            <td>-->
    <!--                <a href="#" class="download-link">-->
    <!--                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download" viewBox="0 0 24 24">-->
    <!--                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>-->
    <!--                        <polyline points="7 10 12 15 17 10"></polyline>-->
    <!--                        <line x1="12" y1="15" x2="12" y2="3"></line>-->
    <!--                    </svg>-->
    <!--                </a>-->
    <!--            </td>-->
    <!--        </tr>-->
    <!--        </tbody>-->
    <!--    </table>-->

    <!-- 페이지네이션 -->
    <div class="pagination" th:if="${not reports.isEmpty()}">
        <span th:if="${currentPage > 1}">
            <a th:href="@{/manager/report(query=${query}, status=${status}, page=${currentPage - 1})}">이전</a>
        </span>
        <span th:each="i : ${#numbers.sequence(1, totalPages)}">
            <a th:href="@{/manager/report(query=${query}, status=${status}, page=${i})}"
               th:text="${i}"
               th:classappend="${i == currentPage} ? 'active' : ''"></a>
        </span>
        <span th:if="${currentPage < totalPages}">
            <a th:href="@{/manager/report(query=${query}, status=${status}, page=${currentPage + 1})}">다음</a>
        </span>
    </div>

</main>
<div th:replace="layouts/footer::tellMe_footer"></div>


</body>
</html>